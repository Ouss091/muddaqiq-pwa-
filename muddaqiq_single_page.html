<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ø§Ù„Ù…Ø¯Ù‚Ù‘Ù‚ â€” Ù†Ø³Ø®Ø© ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</title>
  <meta name="theme-color" content="#121212"/>
  <style>
    :root{--bg:#121212;--fg:#fff;--card:#1e1e1e;--accent:#3A86FF;--gold:#FFD166;}
    *{box-sizing:border-box;font-family:'Noto Naskh Arabic', system-ui, sans-serif}
    body{margin:0;background:var(--bg);color:var(--fg)}
    header{position:sticky;top:0;background:linear-gradient(#121212dd,#12121200);backdrop-filter:saturate(120%) blur(2px);z-index:5}
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    .chip{display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid #444;background:#0000;cursor:pointer;margin:4px}
    .chip.on{border-color:var(--accent);background:rgba(58,134,255,.18)}
    .chip.all.on{border-color:var(--gold);background:rgba(255,209,102,.25)}
    textarea{width:100%;min-height:45vh;background:var(--card);color:var(--fg);border:1px solid #333;border-radius:16px;padding:16px;font-size:18px;line-height:1.7}
    .bar{position:fixed;left:0;right:0;bottom:0;padding:12px;background:linear-gradient(#0000,#121212aa,#121212);}
    .row{display:flex;gap:10px}
    button{flex:1;padding:14px 16px;border-radius:14px;border:none;color:#fff;background:var(--accent);font-size:16px}
    button.tonal{background:#2a2a2a}
    .hint{opacity:.8;font-size:14px;margin:6px 2px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div>
        <span class="chip" id="chip-lang">ØªØµØ­ÙŠØ­ Ø§Ù„Ù„ØºØ©</span>
        <span class="chip on" id="chip-spell">ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡</span>
        <span class="chip" id="chip-meaning">ØªØµØ­ÙŠØ­ Ø§Ù„Ù…Ø¹Ù†Ù‰</span>
        <span class="chip all" id="chip-all">Ø§Ù„ÙƒÙ„ ğŸŒŸ</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <p class="hint">Ø§ÙƒØªØ¨ Ù†ØµÙƒ Ø«Ù… Ø§Ø¶ØºØ· Â«ØªØ¯Ù‚ÙŠÙ‚Â». Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ.</p>
    <textarea id="text" placeholder="Ø§ÙƒØªØ¨ Ù†ØµÙƒ Ù‡Ù†Ø§... Ø«Ù… Ø§Ø¶ØºØ· ØªØ¯Ù‚ÙŠÙ‚ Ø£Ùˆ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨"></textarea>
    <div class="hint" id="status">ÙˆØ¶Ø¹ ØºÙŠØ± Ù…ØªØµÙ„ (Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·)</div>
  </main>

  <div class="bar">
    <div class="wrap">
      <div class="row">
        <button id="btn-proof">ØªØ¯Ù‚ÙŠÙ‚</button>
        <button class="tonal" id="btn-style">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨</button>
      </div>
    </div>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const state={
      fixLang: JSON.parse(localStorage.getItem('fixLang')||'false'),
      spell: JSON.parse(localStorage.getItem('spell')||'true'),
      meaning: JSON.parse(localStorage.getItem('meaning')||'false'),
      all: JSON.parse(localStorage.getItem('all')||'false'),
    };
    function render(){
      $('#chip-lang').classList.toggle('on', state.fixLang);
      $('#chip-spell').classList.toggle('on', state.spell);
      $('#chip-meaning').classList.toggle('on', state.meaning);
      $('#chip-all').classList.toggle('on', state.all);
    }
    function save(){ localStorage.setItem('fixLang', JSON.stringify(state.fixLang));
      localStorage.setItem('spell', JSON.stringify(state.spell));
      localStorage.setItem('meaning', JSON.stringify(state.meaning));
      localStorage.setItem('all', JSON.stringify(state.all));
    }
    $('#chip-lang').onclick=()=>{state.fixLang=!state.fixLang;state.all=false;save();render();};
    $('#chip-spell').onclick=()=>{state.spell=!state.spell;state.all=false;save();render();};
    $('#chip-meaning').onclick=()=>{state.meaning=!state.meaning;state.all=false;save();render();};
    $('#chip-all').onclick=()=>{state.all=!state.all;state.fixLang=state.all;state.spell=state.all;state.meaning=state.all;save();render();};

    // Local processors
    const norm = t => t.replaceAll('?', 'ØŸ').replaceAll(',', 'ØŒ').replace(/Ù€+/g,'')
      .replace(/(ØŒ|Ø›|:|!|ØŸ)([^\s\n\r])/g,(_,p1,p2)=>p1+' '+p2).replace(/\s+(?=(ØŒ|Ø›|:|!|ØŸ))/g,'')
      .replace(/(\S)\s{2,}(\S)/g,'$1 $2');
    const lang = t => t.replace(/\bØ¬Ø¯Ø§\b/g,'Ø¬Ø¯Ù‹Ù‘Ø§').replace(/(^|[\.!ØŸ]\s+)(ÙŠÙˆØ¬Ø¯\s)/g,(_,p1)=>p1+'Ù‡Ù†Ø§Ùƒ ');
    const meaning = t => t.replace(/Ø°Ù„Ùƒ\s+Ø§Ù„Ø£Ù…Ø±/g,'Ø°Ù„Ùƒ').replace(/(\b[\u0600-\u06FF]+\b)\s+\1/g,'$1');
    const style = t => t.replace(/\s+/g,' ').trim().replace(/\bØ­Ù‚Ø§\b/g,'Ø­Ù‚Ù‹Ù‘Ø§').replace(/\bØ¨Ø§Ù„Ø±ØºÙ…\b/g,'Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ…');

    $('#btn-proof').onclick=()=>{
      const ta=$('#text'); let t=ta.value;
      const doLang = state.fixLang || state.all;
      const doSpell = state.spell || state.all;
      const doMeaning = state.meaning || state.all;
      if(doSpell) t = norm(t);
      if(doLang) t = lang(t);
      if(doMeaning) t = meaning(t);
      ta.value = t;
    };
    $('#btn-style').onclick=()=>{
      const ta=$('#text'); ta.value = style(ta.value);
    };
    render();
  </script>
</body>
</html>
